<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>デジタル会員証</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f4f4f4; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 300px; margin: auto; }
        .rank { font-weight: bold; color: #06C755; font-size: 1.2em; }
        .point { font-size: 1.5em; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Member Card</h2>
        <p id="user-name">取得中...</p>
        <hr>
        <p>現在のランク</p>
        <p id="user-rank" class="rank">-</p>
        <p>保有ポイント</p>
        <p id="user-point" class="point">-</p>
        <small id="user-number">No. -----</small>
    </div>

    <script>
        async function main() {
            try {
                // LIFFの初期化
                await liff.init({ liffId: "2007046922-qweO2z33" });

                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                // プロフィール取得
                const profile = await liff.getProfile();
                
                // GASのURL（先ほどコピーしたものに書き換えてください）
                const gasUrl = "https://script.google.com/macros/s/AKfycbwsZEuEwYfCD8wMhuK5-KUB-cNfsAZW-4eRfv1ZsmsGEveQ5vwePfOfzK1NMXl9LsH_Ew/exec";

                // GASにデータをリクエスト
                const response = await fetch(`${gasUrl}?userId=${profile.userId}`);
                const data = await response.json();

                // 画面の書き換え
                if (data.status === "success") {
                    document.getElementById('user-name').innerText = data.name + " 様";
                    document.getElementById('user-rank').innerText = data.rank;
                    document.getElementById('user-point').innerText = data.point + " pt";
                    document.getElementById('user-number').innerText = "No. " + data.number;
                } else {
                    document.getElementById('user-name').innerText = "データが見つかりません";
                }

            } catch (error) {
                console.error(error);
                document.getElementById('user-name').innerText = "エラーが発生しました";
            }
        }
        main();
    </script>
</body>
</html>
